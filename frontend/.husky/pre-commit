#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Frontend checks
echo "ğŸ“¦ Checking frontend..."
cd frontend 2>/dev/null || cd .

# Run lint-staged (handles linting and formatting)
npm run pre-commit

# Type checking
echo "ğŸ” Type checking..."
npm run type-check

# Security audit (only high/critical vulnerabilities)
echo "ğŸ” Security audit..."
npm audit --audit-level=high || echo "âš ï¸  Security vulnerabilities found, but allowing commit. Please review!"

# Check for console statements in staged files
echo "ğŸš« Checking for console statements..."
cd ..
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep -E '\.(ts|tsx)$' || true)
if [ -n "$STAGED_TS_FILES" ]; then
  if echo "$STAGED_TS_FILES" | xargs grep -n 'console\.\(log\|debug\|info\)' 2>/dev/null; then
    echo "âŒ Found console statements in staged files. Please remove them or use console.error/console.warn for intentional logging."
    exit 1
  fi
fi

echo "âœ… Frontend checks passed!"
